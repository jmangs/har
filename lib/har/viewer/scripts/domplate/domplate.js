require.def("domplate/domplate",[],function(){Domplate={},function(){function defineTags(){for(var a=0;a<arguments.length;++a){var b=arguments[a],c=new Function("var newTag = new Domplate.DomplateTag('"+b+"'); return newTag.merge(arguments);"),d=b.toUpperCase();Domplate[d]=c}}function StopIteration(){}function ArrayIterator(a){var b=-1;this.next=function(){if(++b>=a.length)throw StopIteration;return a[b]}}function extend(a,b){for(var c in b)a[c]=b[c]}function copyObject(a,b){var c={};extend(c,a),extend(c,b);return c}function copyArray(a){var b=[];if(a)for(var c=0;c<a.length;++c)b.push(a[c]);return b}function creator(a,b){var c=new Function("var tag = arguments.callee.tag;var cons = arguments.callee.cons;var newTag = new cons();return newTag.merge(arguments, tag);");c.tag=a,c.cons=b,extend(c,Renderer);return c}function isDomplate(a){return typeof a=="object"&&!!a.render}function isTag(a){return(typeof a=="function"||a instanceof Function)&&!!a.tag}function addParts(a,b,c,d,e){var f=[];if(a instanceof Parts)for(var g=0;g<a.parts.length;++g){var h=a.parts[g];if(h instanceof Variable){var i=h.name;if(h.format)for(var j=0;j<h.format.length;++j)i=h.format[j]+"("+i+")";e?f.push("__escape__("+i+")"):f.push(i)}else f.push('"'+h+'"')}else isTag(a)?(d.args.push(a),f.push("s"+d.argIndex++)):f.push('"'+a+'"');var k=f.join(b);k&&c.push(b,k)}function generateArg(a,b,c){if(a instanceof Parts){var d=[];for(var e=0;e<a.parts.length;++e){var f=a.parts[e];if(f instanceof Variable){var g="d"+b.renderIndex++;if(f.format)for(var h=0;h<f.format.length;++h)g=f.format[h]+"("+g+")";d.push(g)}else d.push('"'+f.replace(/"/g,'\\"')+'"')}return d.join("+")}c.push(a);return"s"+b.staticIndex++}function readPartNames(a,b){if(a instanceof Parts)for(var c=0;c<a.parts.length;++c){var d=a.parts[c];d instanceof Variable&&b.push(d.name)}}function parseChildren(a,b,c,d){for(var e=b;e<a.length;++e){var f=parseValue(a[e]);d.push(f),readPartNames(f,c)}}function parseValue(a){return typeof a=="string"?parseParts(a):a}function parseParts(a){var b=/\$([_A-Za-z][_A-Za-z0-9.|]*)/g,c=0,d=[],e;while(e=b.exec(a)){var f=a.substr(c,b.lastIndex-e[0].length-c);f&&d.push(f);var g=e[1].split("|");d.push(new Variable(g[0],g.slice(1))),c=b.lastIndex}if(!c)return a;var h=a.substr(c);h&&d.push(h);return new Parts(d)}function Parts(a){this.parts=a}function Variable(a,b){this.name=a,this.format=b}function DomplateLoop(){}function DomplateEmbed(){}function DomplateTag(a){this.tagName=a}this.DomplateTag=DomplateTag;var womb=null,domplate=function(){var a;for(var b=0;b<arguments.length;++b)a=a?copyObject(a,arguments[b]):arguments[b];for(var c in a){var d=a[c];isTag(d)&&(d.tag.subject&&(a[c]=d=copyObject({},d),d.tag=copyObject({},d.tag)),d.tag.subject=a)}return a};domplate.context=function(a,b){var c=domplate.lastContext;domplate.topContext=a,b.apply(a),domplate.topContext=c},this.domplate=domplate,this.create=domplate,this.TAG=function(){var a=new DomplateEmbed;return a.merge(arguments)},this.FOR=function(){var a=new DomplateLoop;return a.merge(arguments)},DomplateTag.prototype={merge:function(a,b){b&&(this.tagName=b.tagName),this.context=b?b.context:null,this.subject=b?b.subject:null,this.attrs=b?copyObject(b.attrs):{},this.classes=b?copyObject(b.classes):{},this.props=b?copyObject(b.props):null,this.listeners=b?copyArray(b.listeners):null,this.children=b?copyArray(b.children):[],this.vars=b?copyArray(b.vars):[];var c=a.length?a[0]:null,d=typeof c=="object"&&!isTag(c);this.children=[],domplate.topContext&&(this.context=domplate.topContext),a.length&&parseChildren(a,d?1:0,this.vars,this.children),d&&this.parseAttrs(c);return creator(this,DomplateTag)},parseAttrs:function(a){for(var b in a){var c=parseValue(a[b]);readPartNames(c,this.vars);if(b.indexOf("on")==0){var d=$.browser.msie?b:b.substr(2);this.listeners||(this.listeners=[]),this.listeners.push(d,c)}else if(b.indexOf("_")==0){var e=b.substr(1);this.props||(this.props={}),this.props[e]=c}else if(b.indexOf("$")==0){var f=b.substr(1);this.classes||(this.classes={}),this.classes[f]=c}else b=="class"&&b in this.attrs?this.attrs[b]+=" "+c:this.attrs[b]=c}},compile:function(){this.renderMarkup||(this.compileMarkup(),this.compileDOM())},compileMarkup:function(){function __loop__(a,b,c){var d=[];b.push(d),a instanceof Array&&(a=new ArrayIterator(a));try{while(1){var e=a.next(),f=[0,0];d.push(f),c.apply(this,[e,f])}}catch(g){if(g!=StopIteration)throw g}}function __escape__(a){function b(a){switch(a){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&#39;";case'"':return"&quot;"}return"?"}return String(a).replace(/[<>&"']/g,b)}function __link__(a,b,c,d){a.tag.compile();var e=[],f=[b,a.tag.context,d,e];f.push.apply(f,a.tag.markupArgs),a.tag.renderMarkup.apply(a.tag.subject,f),c.push(a),c.push(e)}this.markupArgs=[];var topBlock=[],topOuts=[],blocks=[],info={args:this.markupArgs,argIndex:0};this.generateMarkup(topBlock,topOuts,blocks,info),this.addCode(topBlock,topOuts,blocks);var fnBlock=["(function (__code__, __context__, __in__, __out__"];for(var i=0;i<info.argIndex;++i)fnBlock.push(", s",i);fnBlock.push(") {\n"),this.subject&&fnBlock.push("with (this) {\n"),this.context&&fnBlock.push("with (__context__) {\n"),fnBlock.push("with (__in__) {\n"),fnBlock.push.apply(fnBlock,blocks),this.subject&&fnBlock.push("}\n"),this.context&&fnBlock.push("}\n"),fnBlock.push("}})\n");var js=$.browser.msie?"var f = "+fnBlock.join("")+";f":fnBlock.join("");this.renderMarkup=eval(js)},getVarNames:function(a){this.vars&&a.push.apply(a,this.vars);for(var b=0;b<this.children.length;++b){var c=this.children[b];if(isTag(c))c.tag.getVarNames(a);else if(c instanceof Parts)for(var b=0;b<c.parts.length;++b)if(c.parts[b]instanceof Variable){var d=c.parts[b].name,e=d.split(".");a.push(e[0])}}},generateMarkup:function(a,b,c,d){a.push(',"<',this.tagName,'"');for(var e in this.attrs)if(e!="class"){var f=this.attrs[e];a.push(', " ',e,'=\\""'),addParts(f,",",a,d,!0),a.push(', "\\""')}if(this.listeners)for(var g=0;g<this.listeners.length;g+=2)readPartNames(this.listeners[g+1],b);if(this.props)for(var e in this.props)readPartNames(this.props[e],b);if("class"in this.attrs||this.classes){a.push(', " class=\\""'),"class"in this.attrs&&addParts(this.attrs["class"],",",a,d,!0),a.push(', " "');for(var e in this.classes)a.push(", ("),addParts(this.classes[e],"",a,d),a.push(' ? "',e,'" + " " : "")');a.push(', "\\""')}a.push(',">"'),this.generateChildMarkup(a,b,c,d),a.push(',"</',this.tagName,'>"')},generateChildMarkup:function(a,b,c,d){for(var e=0;e<this.children.length;++e){var f=this.children[e];isTag(f)?f.tag.generateMarkup(a,b,c,d):addParts(f,",",a,d,!0)}},addCode:function(a,b,c){a.length&&c.push('__code__.push(""',a.join(""),");\n"),b.length&&c.push("__out__.push(",b.join(","),");\n"),a.splice(0,a.length),b.splice(0,b.length)},addLocals:function(a){var b=[];this.getVarNames(b);var c={};for(var d=0;d<b.length;++d){var e=b[d];if(c.hasOwnProperty(e))continue;c[e]=1;var f=e.split(".");a.push("var ",f[0]+" = __in__."+f[0]+";\n")}},compileDOM:function(){function __path__(a,b){var c=a;for(var d=2;d<arguments.length;++d){var e=arguments[d];d==3&&(e+=b),e==-1?a=a.parentNode:a=a.childNodes[e]}return a}function __loop__(a,b){var c=0;for(var d=0;d<a.length;++d)a[d][0]=d,a[d][1]=c,c+=b.apply(this,a[d]);return c}function __link__(a,b,c){b.tag.compile();var d=[a,b.tag.context,0];d.push.apply(d,b.tag.domArgs),d.push.apply(d,c);return b.tag.renderDOM.apply(b.tag.subject,d)}function __bind__(a,b){return function(c){return b.apply(a,[c])}}function __prop__(a,b,c){a[b]=c}var path=[],blocks=[];this.domArgs=[],path.embedIndex=0,path.loopIndex=0,path.staticIndex=0,path.renderIndex=0;var nodeCount=this.generateDOM(path,blocks,this.domArgs),fnBlock=["(function (root, context, o"];for(var i=0;i<path.staticIndex;++i)fnBlock.push(", ","s"+i);for(var i=0;i<path.renderIndex;++i)fnBlock.push(", ","d"+i);fnBlock.push(") {\n");for(var i=0;i<path.loopIndex;++i)fnBlock.push("var l",i," = 0;\n");for(var i=0;i<path.embedIndex;++i)fnBlock.push("var e",i," = 0;\n");this.subject&&fnBlock.push("with (this) {\n"),this.context&&fnBlock.push("with (context) {\n"),fnBlock.push(blocks.join("")),this.subject&&fnBlock.push("}\n"),this.context&&fnBlock.push("}\n"),fnBlock.push("return ",nodeCount,";\n"),fnBlock.push("})\n");var self=this,js=$.browser.msie?"var f = "+fnBlock.join("")+";f":fnBlock.join("");this.renderDOM=eval(js)},generateDOM:function(a,b,c){(this.listeners||this.props)&&this.generateNodePath(a,b);if(this.listeners)for(var d=0;d<this.listeners.length;d+=2){var e=this.listeners[d+1],f=generateArg(e,a,c);$.browser.msie?b.push('node.attachEvent("',this.listeners[d],'", __bind__(this, ',f,"));\n"):b.push('node.addEventListener("',this.listeners[d],'", __bind__(this, ',f,"), false);\n")}if(this.props)for(var g in this.props){var e=this.props[g],f=generateArg(e,a,c);b.push("__prop__(node, '"+g+"', "+f+");\n")}this.generateChildDOM(a,b,c);return 1},generateNodePath:function(a,b){b.push("var node = __path__(root, o");for(var c=0;c<a.length;++c)b.push(",",a[c]);b.push(");\n")},generateChildDOM:function(a,b,c){a.push(0);for(var d=0;d<this.children.length;++d){var e=this.children[d];isTag(e)?a[a.length-1]+="+"+e.tag.generateDOM(a,b,c):a[a.length-1]+="+1"}a.pop()}},DomplateEmbed.prototype=copyObject(DomplateTag.prototype,{merge:function(a,b){this.value=b?b.value:parseValue(a[0]),this.attrs=b?b.attrs:{},this.vars=b?copyArray(b.vars):[];var c=a[1];for(var d in c){var e=parseValue(c[d]);this.attrs[d]=e,readPartNames(e,this.vars)}return creator(this,DomplateEmbed)},getVarNames:function(a){this.value instanceof Parts&&a.push(this.value.parts[0].name),this.vars&&a.push.apply(a,this.vars)},generateMarkup:function(a,b,c,d){this.addCode(a,b,c),c.push("__link__("),addParts(this.value,"",c,d),c.push(", __code__, __out__, {\n");var e=null;for(var f in this.attrs){e&&c.push(","),e=f;var g=this.attrs[f];c.push('"',f,'":'),addParts(g,"",c,d)}c.push("});\n")},generateDOM:function(a,b,c){var d="e"+a.embedIndex++;this.generateNodePath(a,b);var e="d"+a.renderIndex++,f="d"+a.renderIndex++;b.push(d+" = __link__(node, ",e,", ",f,");\n");return d}}),DomplateLoop.prototype=copyObject(DomplateTag.prototype,{merge:function(a,b){this.isLoop=!0,this.varName=b?b.varName:a[0],this.iter=b?b.iter:parseValue(a[1]),this.vars=[],this.children=b?copyArray(b.children):[];var c=Math.min(a.length,2);parseChildren(a,c,this.vars,this.children);return creator(this,DomplateLoop)},getVarNames:function(a){this.iter instanceof Parts&&a.push(this.iter.parts[0].name),DomplateTag.prototype.getVarNames.apply(this,[a])},generateMarkup:function(a,b,c,d){this.addCode(a,b,c);var e;if(this.iter instanceof Parts){var f=this.iter.parts[0];e=f.name;if(f.format)for(var g=0;g<f.format.length;++g)e=f.format[g]+"("+e+")"}else e=this.iter;c.push("__loop__.apply(this, [",e,", __out__, function(",this.varName,", __out__) {\n"),this.generateChildMarkup(a,b,c,d),this.addCode(a,b,c),c.push("}]);\n")},generateDOM:function(a,b,c){var d="d"+a.renderIndex++,e="i"+a.loopIndex,f="l"+a.loopIndex++;a.length||a.push(-1,0);var g=a.renderIndex;a.renderIndex=0;var h=0,i=[],j=a[a.length-1];for(var k=0;k<this.children.length;++k){a[a.length-1]=j+"+"+f+"+"+h;var l=this.children[k];isTag(l)?h+="+"+l.tag.generateDOM(a,i,c):h+="+1"}a[a.length-1]=j+"+"+f,b.push(f," = __loop__.apply(this, [",d,", function(",e,",",f);for(var k=0;k<a.renderIndex;++k)b.push(",d"+k);b.push(") {\n"),b.push(i.join("")),b.push("return ",h,";\n"),b.push("}]);\n"),a.renderIndex=g;return f}}),this.$break=function(){throw StopIteration};var Renderer={renderHTML:function(a,b,c){var d=[],e=[d,this.tag.context,a,b];e.push.apply(e,this.tag.markupArgs),this.tag.renderMarkup.apply(c?c:this.tag.subject,e);return d.join("")},insertRows:function(a,b,c){this.tag.compile();var d=[],e=this.renderHTML(a,d,c),f=b.ownerDocument,g=f.createElement("div");g.innerHTML="<table>"+e+"</table>";var h=g.firstChild.firstChild,i=b.tagName.toLowerCase()=="tr"?b.parentNode:b,j=b.tagName.toLowerCase()=="tr"?b.nextSibling:null,k=h.firstChild,l;while(h.firstChild)l=h.firstChild,j?i.insertBefore(l,j):i.appendChild(l);var m=0;if(this.tag.isLoop){var n=k.parentNode.firstChild;for(;n&&n!=k;n=n.nextSibling)++m}var o=[k,this.tag.context,m];o.push.apply(o,this.tag.domArgs),o.push.apply(o,d),this.tag.renderDOM.apply(c?c:this.tag.subject,o);return[k,l]},insertAfter:function(a,b,c){this.tag.compile();var d=[],e=this.renderHTML(a,d,c),f=b.ownerDocument,g=f.createRange();g.selectNode(f.body);var h=g.createContextualFragment(e),i=h.firstChild;b.nextSibling?b.parentNode.insertBefore(h,b.nextSibling):b.parentNode.appendChild(h);var j=[i,this.tag.context,0];j.push.apply(j,this.tag.domArgs),j.push.apply(j,d),this.tag.renderDOM.apply(c?c:this.tag.subject?this.tag.subject:null,j);return i},replace:function(a,b,c){this.tag.compile();var d=[],e=this.renderHTML(a,d,c),f;if(b.nodeType==1)b.innerHTML=e,f=b.firstChild;else{if(!b||b.nodeType!=9)b=document;if(!womb||womb.ownerDocument!=b)womb=b.createElement("div");womb.innerHTML=e,f=womb.firstChild}var g=[f,this.tag.context,0];g.push.apply(g,this.tag.domArgs),g.push.apply(g,d),this.tag.renderDOM.apply(c?c:this.tag.subject,g);return f},append:function(a,b,c){this.tag.compile();var d=[],e=this.renderHTML(a,d,c);if(!womb||womb.ownerDocument!=b.ownerDocument)womb=b.ownerDocument.createElement("div");womb.innerHTML=e;var f=womb.firstChild;while(womb.firstChild)b.appendChild(womb.firstChild);var g=[f,this.tag.context,0];g.push.apply(g,this.tag.domArgs),g.push.apply(g,d),this.tag.renderDOM.apply(c?c:this.tag.subject,g);return f},insertCols:function(a,b,c){this.tag.compile();var d=[],e=this.renderHTML(a,d,c),f=b.ownerDocument.createElement("div");f.innerHTML="<table><tbody><tr>"+e+"</tr></tbody></table>",f=f.firstChild.firstChild.firstChild;var g=f.firstChild;if(!g)return null;while(f.firstChild)b.appendChild(f.firstChild);var h=0;if(this.tag.isLoop){var i=g.parentNode.firstChild;for(;i&&i!=g;i=i.nextSibling)++h}var j=[g,this.tag.context,h];j.push.apply(j,this.tag.domArgs),j.push.apply(j,d),this.tag.renderDOM.apply(c?c:this.tag.subject,j);return g}};defineTags("a","button","br","canvas","col","colgroup","div","fieldset","form","h1","h2","h3","hr","img","input","label","legend","li","ol","optgroup","option","p","pre","select","span","strong","table","tbody","td","textarea","tfoot","th","thead","tr","tt","ul","code","iframe","canvas")}.apply(Domplate);return Domplate})